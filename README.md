# OKX åˆçº¦å¸¦å•ï¼ˆSWAPï¼‰è§‚å¯Ÿå·¥å…·

è¿™æ˜¯ä¸€ä¸ªåŸºäº Cloudflare ç”Ÿæ€ï¼ˆPages + Workers + D1ï¼‰æ„å»ºçš„ OKX äº¤æ˜“å‘˜è§‚å¯Ÿä¸æ•°æ®è¿½è¸ªå·¥å…·ã€‚å®ƒå¯ä»¥å¸®ä½ è®°å½•äº¤æ˜“å‘˜çš„å†å²èµ„é‡‘è§„æ¨¡å˜åŒ–ï¼Œè§£å†³å®˜ç½‘æ•°æ®åªèƒ½çœ‹å½“å‰å€¼ã€æ— æ³•å›æº¯å†å²çš„é—®é¢˜ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- **å†å²è¿½è¸ª**: è‡ªåŠ¨æ¯ 5 åˆ†é’Ÿè®°å½•ä¸€æ¬¡è§‚å¯Ÿåˆ—è¡¨ä¸­çš„äº¤æ˜“å‘˜æ•°æ®ã€‚
- **æ•°æ®æ ¡å‡†**: å®Œç¾å¯¹é½ OKX å®˜ç½‘çš„åè¯å®šä¹‰ï¼ˆäº¤æ˜“å‘˜å¸¦å•èµ„äº§ vs è‡ªæœ‰èµ„é‡‘ï¼‰ã€‚
- **éšç§å®‰å…¨**: æ•°æ®å­˜å‚¨åœ¨ä½ è‡ªå·±çš„ Cloudflare D1 æ•°æ®åº“ä¸­ã€‚
- **æ— éœ€æœåŠ¡å™¨**: çº¯ Serverless æ¶æ„ï¼Œä½æˆæœ¬ç”šè‡³å…è´¹ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

ä½ éœ€è¦å®‰è£… [Node.js](https://nodejs.org/) å’Œ [Wrangler](https://developers.cloudflare.com/workers/wrangler/install-and-update/)ã€‚

1. **ç™»å½• Cloudflare**
   ```bash
   wrangler login
   ```

2. **åˆå§‹åŒ–æ•°æ®åº“** (æ³¨æ„ï¼šè¿™ä¼šæ¸…ç©ºç°æœ‰æ•°æ®)
   ```bash
   npm run db:reset
   ```

3. **å¯åŠ¨æœ¬åœ°å¼€å‘**
   ```bash
   npm run dev
   ```

4. **è°ƒè¯•åç«¯ (å¯é€‰)**
   ```bash
   npm run dev:worker
   ```

---

## ğŸ“– ä½¿ç”¨æŒ‡å— (How to Use)

### 1. éªŒè¯ç®¡ç†å‘˜æƒé™
è¿›å…¥ç½‘é¡µåï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„ **â€œè®¾ç½®â€** æŒ‰é’®ã€‚
- è¾“å…¥å¯†ç ï¼ˆé»˜è®¤ä¸º `admin`ï¼Œå¯åœ¨ Cloudflare åå°è®¾ç½®ä¸º `ADMIN_PASSWORD` ç¯å¢ƒå˜é‡ï¼‰ã€‚
- ç‚¹å‡» **â€œéªŒè¯å¯†ç â€**ã€‚éªŒè¯æˆåŠŸåè§£é”å…¨éƒ¨åŠŸèƒ½ã€‚

### 2. æ·»åŠ è§‚å¯Ÿ (Watch)
åªæœ‰è¢«â€œè§‚å¯Ÿâ€çš„äº¤æ˜“å‘˜æ‰ä¼šå¼€å§‹è®°å½•å†å²æ•°æ®ã€‚
- **æ–¹æ³• A**: åœ¨â€œå‰ 50 äº¤æ˜“å‘˜â€åˆ—è¡¨ä¸­ï¼Œç‚¹å‡»å¡ç‰‡å³ä¸Šè§’çš„ **+** å·ã€‚
- **æ–¹æ³• B**: åœ¨è®¾ç½®é¢æ¿è¾“å…¥ `instId` (å³ uniqueCode)ï¼Œç‚¹å‡»â€œè§‚å¯Ÿâ€ã€‚

### 3. æŸ¥çœ‹å›¾è¡¨
ç‚¹å‡»ä»»æ„äº¤æ˜“å‘˜å¡ç‰‡ï¼Œå¼¹å‡ºè¯¦æƒ…çª—å£ï¼š
- **Tab 1 äº¤æ˜“å‘˜å¸¦å•èµ„äº§**: æ˜¾ç¤º `æ€»AUM` è¶‹åŠ¿ (è·Ÿå•æ€»é¢ + äº¤æ˜“å‘˜è‡ªæœ‰èµ„é‡‘)ã€‚
- **Tab 2 å¸¦å•è§„æ¨¡**: æ˜¾ç¤º `è·Ÿå•èµ„é‡‘` è¶‹åŠ¿ (ä»…è·Ÿå•è€…éƒ¨åˆ†)ã€‚
- *å°†é¼ æ ‡æ‚¬åœåœ¨å›¾è¡¨ä¸Šå¯æŸ¥çœ‹å…·ä½“æ•°å€¼å’Œæ—¶é—´ç‚¹ã€‚*

### 4. å¼ºåˆ¶åˆ·æ–°
åå° Worker ä¼šæ¯ 5 åˆ†é’Ÿè‡ªåŠ¨æŠ“å–ä¸€æ¬¡ã€‚å¦‚æœä½ æƒ³ç«‹å³çœ‹æœ€æ–°æ•°æ®ï¼š
- æ‰“å¼€è®¾ç½®é¢æ¿ -> ç‚¹å‡» **â€œæ‰‹åŠ¨åˆ·æ–°æ•°æ®â€** æŒ‰é’®ã€‚

---

## ğŸ“Š æ•°æ®é€»è¾‘ä¸å­—æ®µè¯´æ˜

æœ¬ç³»ç»Ÿä½¿ç”¨äº† 3 å¼  D1 æ•°æ®è¡¨ã€‚

### 1. äº¤æ˜“å‘˜åŸºç¡€ä¿¡æ¯ (`trader_info`)
å­˜å‚¨äº¤æ˜“å‘˜çš„é™æ€ä¿¡æ¯ï¼Œæ¯æ¬¡æŠ“å–æ—¶ä¼šè¦†ç›–æ›´æ–°ã€‚

| å­—æ®µ | å«ä¹‰ | å¯¹åº” OKX å­—æ®µ |
| :--- | :--- | :--- |
| `instId` | å”¯ä¸€ID | `uniqueCode` |
| `nickName` | æ˜µç§° | `nickName` |
| `leadDays` | å¸¦å•å¤©æ•° | `leadDays` |
| `copyTraderNum` | è·Ÿå•äººæ•° | `copyTraderNum` |

### 2. è§‚å¯Ÿåˆ—è¡¨ (`watched_traders`)
ä»…ç”¨äºè®°å½•ä½ å½“å‰æ­£åœ¨å…³æ³¨å“ªäº› `instId`ã€‚

### 3. å†å²æŒ‡æ ‡æ•°æ® (`watched_trader_metrics`)
æ ¸å¿ƒæ•°æ®è¡¨ï¼Œå­˜æœ‰æ—¶åºæ•°æ®ã€‚

| å­—æ®µ | å«ä¹‰ | OKX å¯¹åº”å…³ç³» (å…³é”®) |
| :--- | :--- | :--- |
| **`aum`** | **å¸¦å•è§„æ¨¡** | å¯¹åº”å®˜ç½‘çš„â€œå¸¦å•è§„æ¨¡â€ (ä»…è·Ÿå•è€…èµ„é‡‘) |
| **`investAmt`** | **è‡ªæœ‰èµ„é‡‘** | å¯¹åº”å®˜ç½‘çš„â€œè‡ªæœ‰èµ„é‡‘â€ |
| **`totalAum`*** | **äº¤æ˜“å‘˜å¸¦å•èµ„äº§** | **å‰ç«¯è®¡ç®—å€¼** = `aum` + `investAmt` |
| `timestamp` | è®°å½•æ—¶é—´ | æ¯ 5 åˆ†é’Ÿä¸€ä¸ªç‚¹ |

> *æ³¨æ„ï¼šOKX API è¿”å›çš„ `aum` å®é™…ä¸Šæ˜¯ä¸åŒ…å«äº¤æ˜“å‘˜è‡ªæœ‰èµ„é‡‘çš„ã€‚ä¸ºäº†å’Œå®˜ç½‘â€œäº¤æ˜“å‘˜å¸¦å•èµ„äº§â€å¯¹é½ï¼Œå‰ç«¯å±•ç¤ºæ—¶æˆ‘ä»¬å°†ä¸¤è€…ç›¸åŠ ã€‚*

---

## ğŸ› ï¸ éƒ¨ç½²å‘½ä»¤ (Deployment)

### éƒ¨ç½²å‰ç«¯ç½‘é¡µ
```bash
npm run deploy:site
```

### éƒ¨ç½²åç«¯é‡‡é›†å™¨ (Worker)
```bash
npm run deploy:worker
```

### è®¾ç½®ç”Ÿäº§ç¯å¢ƒå¯†ç 
```bash
wrangler secret put ADMIN_PASSWORD
# è¾“å…¥ä½ æƒ³è®¾ç½®çš„å¯†ç ï¼Œä¾‹å¦‚ mysecret123
```

---

## ğŸ”— å‚è€ƒ API æ•°æ®æº

- **åˆ—è¡¨ä¸ AUM**: `/api/v5/copytrading/public-lead-traders?instType=SWAP`
- **è¯¦ç»†æŒ‡æ ‡**: `/api/v5/copytrading/public-stats?instType=SWAP&uniqueCode=xxx`
